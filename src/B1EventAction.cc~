

#include "B1EventAction.hh"
#include "B1RunAction.hh"
#include "HistoManager.hh"

#include "G4Event.hh"
#include "G4RunManager.hh"


//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......

B1EventAction::B1EventAction(B1RunAction* runAction, HistoManager* histo)
: G4UserEventAction(),
  fRunAction(runAction),
  fHistoManager(histo),
  fEdep1(0.), f2Edep1(0.),
  fEdep2(0.), f2Edep2(0.),
  fEdep3(0.),
  fPrintModulo(0)
{fPrintModulo=100;}

//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......

B1EventAction::~B1EventAction()
{}

//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......

void B1EventAction::BeginOfEventAction(const G4Event* evt)
{    
    G4int evtNb = evt->GetEventID();
    if (evtNb%fPrintModulo == 0)
        G4cout << "\n---> Begin of event: " << evtNb << G4endl;
    
    // initialisation per event
    f2Edep1 = 0.;
    f2Edep2 = 0.;
    fEdep1  = 0.;
    fEdep2  = 0.;
    fEdep3 = 0.;
}

//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......



void B1EventAction::EndOfEventAction(const G4Event*)
{
    fRunAction->FillPerEvent(fEdep1, fEdep2);

    //fill histograms
    //
    if(fEdep1>0 && fEdep2 > 0){
        fHistoManager->FillHisto(0, fEdep1);
        fHistoManager->FillHisto(1, fEdep2);
    }
    //fill ntuple
    //
    fHistoManager->FillNtuple(fEdep1, fEdep2);
    
  bool debug = false;
  // accumulate statistics in run action
  fRunAction->AddEdep1(fEdep1);
    fRunAction->AddEdep2(fEdep2);
    fRunAction->AddEdep3(fEdep3);
    fRunAction->GetConteggi()->IncreaseTotCount();
    
    if(fEdep1>0){
        fRunAction->GetConteggi()->IncreaseUp();
        if(debug) G4cout << "up"<<G4endl;
    }
    if(fEdep2>0){fRunAction->GetConteggi()->IncreaseDown();
      if(debug) G4cout << "down"<<G4endl;
        
    }
    if(fEdep3>0){fRunAction->GetConteggi()->IncreaseCher();
      if(debug) G4cout << "cher"<<G4endl;
        
    }
    if(fEdep1>0 && fEdep2>0){fRunAction->GetConteggi()->IncreaseCoinc();
      if(debug)G4cout << "coincidence"<<G4endl;
        
    }
    if(fEdep1>0 && fEdep2>0 && fEdep3>0){fRunAction->GetConteggi()->IncreaseTri();
      if(debug)G4cout << "tripla"<<G4endl;}

    
}

//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......
